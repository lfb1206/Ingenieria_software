<h1 align='center' class = "title is-2 has-text-primary" >Turnos</h1>

<div align='center'>    
    <a>
    <%= button_to "Nuevo turno", turnos_new_path,:id => "boton_turnos", :class => "button is-primary is-rounded is-outlined is-right", :method => :get %>
    </a>
</div>

<br>

<div class="filtro-turnos">
    <div class="row">
        <div class="col-12">
            <%= form_tag(search_path, method: "get", remote: true) do %>
            <div class="input-group mb-5">
                <div class="col-8">
                    <%= text_field_tag :search, '', class:'form-control', placeholder:'Search...' onkeydown:'clickSubmit();' %>
                </div>
                <div class="col-3">
                    <%= select_tag "filter", options_for_select(['Seleccione', 'Ida', 'Vuelta']), class:'custom-select' %>
                </div>
                <div class="col-1">
                    <%= submit_tag "Search", class:'btn btn-dark', id:'search_submit' %>
                </div>
            </div>
            <% end %>
        </div>
    </div>
</div>

<script>
    function clickSubmit() {
        $("search_submit").trigger("click");
    }
</script>

    <div class="column">
    <div align='left' style="display: flex; flex-flow: wrap; ">
    <h3 class = "title is-4 has-text-dark" >Turnos Activos</h3>
    </div>
    <br/>
    <div align='center' style="display: flex; flex-flow: wrap;">
        <% @no_vacio = false %>
        <div class="row">
        <% @turnos.each do |turno|%>
            <%if turno.user_id != current_user.id and turno.estado == "ACTIVO"%>
                <div class="column-turno">
                    <% @no_vacio = true %>
                    <b>Conductor </b><p><%= @users.find(turno.user_id).name%></p>
                    <b>Hora salida </b><p><%= turno.hora_salida%></p>
                    <b>Día de la semana </b><p><%= turno.dia_semana%></p>
                    <b>Dirección salida </b><p><%= turno.direccion_salida%></p>
                    <b>Dirección llegada </b><p><%= turno.direccion_llegada%></p>
                    <b></b><p><%= link_to 'Ver detalles', turnos_show_path(:id => turno.id) %></p>
                </div>
            <% end %>
        <% end %>
        <% if not @no_vacio %>
            <br/>
            <div align='center' style="display: flex; flex-flow: wrap; ">
            <h4 class = "title is-4 has-text-dark" >No existen turnos activos</h4>
            </div>
        <% end %>
    </div>
    </div>

    <div class="column">
    <br/>
    <br/>
    <div align='center' style="display: flex; flex-flow: wrap; ">
    <h3 class = "title is-4 has-text-dark" >Turnos Solicitados Confirmados</h3>
    </div>
    <br/>
    <div align='center' style="display: flex; flex-flow: wrap; ">
        <% @no_vacio = false %>
        <div class="row">
        <% @requests.each do |request|%>
            <%if request.user_id == current_user.id %>
                <% @turno = Turno.find(request.turno.id)%> 
                <%if @turno.estado == "CONFIRMADO"%>
                    <div class="column-turno">
                    <% @no_vacio = true %>
                    <% @user = User.find(@turno.user_id)%>
                    <b>Conductor </b><p><%= @users.find(turno.user_id).name%></p>
                    <b>Hora salida </b><p><%= turno.hora_salida%></p>
                    <b>Día de la semana </b><p><%= turno.dia_semana%></p>
                    <b>Dirección salida </b><p><%= turno.direccion_salida%></p>
                    <b>Dirección llegada </b><p><%= turno.direccion_llegada%></p>
                    <b></b><p><%= link_to 'Ver detalles', turnos_show_path(:id => turno.id) %></p>
                </div>
                <% end %>
            <% end %>
        <% end %>
        <% if not @no_vacio %>
            <br/>
            <div align='center' style="display: flex; flex-flow: wrap; ">
            <h4 class = "title is-4 has-text-dark" >No tiene turnos confirmados</h4>
            </div>
        <% end %>
    </div>
    </div>
    </div>

    <div class="column">
    <br/>
    <br/>
    <div align='center' style="display: flex; flex-flow: wrap; ">
    <h3 class = "title is-4 has-text-dark" >Turnos Solicitados Completados</h3>
    </div>
    <br/>
    <div align='center' style="display: flex; flex-flow: wrap; ">
        <% @no_vacio = false %>
        <div class="row">
        <% @requests.each do |request|%>
            <%if request.user_id == current_user.id %>
                <% @turno = Turno.find(request.turno.id)%> 
                <%if @turno.estado == "COMPLETADO"%>
                    <% @no_vacio = true %>
                    <div class="column-turno">
                    <b>Conductor </b><p><%= @users.find(@turno.user_id).name%></p>
                    <b>Hora salida </b><p><%= @turno.hora_salida%></p>
                    <b>Día de la semana </b><p><%= @turno.dia_semana%></p>
                    <b>Dirección salida </b><p><%= @turno.direccion_salida%></p>
                    <b>Dirección llegada </b><p><%= @turno.direccion_llegada%></p>
                    <b></b><p><%= link_to 'Ver detalles', turnos_show_path(:id => @turno.id) %></p>
                </div>
                <% end %>
            <% end %>
        <% end %>
        <% if not @no_vacio %>
            <br/>
            <div align='center' style="display: flex; flex-flow: wrap; ">
            <h4 class = "title is-4 has-text-dark" >No tiene turnos completados</h4>
            </div>
        <% end %>
    </div>
    </div>
</div>
<br/>